import{_ as H,J as X,r as d,C as O,o as Z,a as ee,b as i,c as r,d as v,e as t,t as n,Q as q,f as le,j as $,m as o,P as ae,w as z,F as L,h as D,R as A,S as F,g as te,k as se,T as oe,U as ie,p as re,q as ne}from"./index-c719ee9e.js";import{_ as ue}from"./breadcrumb-7f4f9afa.js";import{_ as de}from"./Nave-55186665.js";import{_ as ce}from"./Footer-97c15535.js";/* empty css                                             */const P=I=>(re("data-v-80ba8110"),I=I(),ne(),I),pe=["dir"],ve=P(()=>t("div",{class:"absolute bg-black opacity-40 w-full h-full z-50"},null,-1)),me=P(()=>t("img",{class:"w-full absolute h-full object-cover",src:ue,alt:"Banner background"},null,-1)),fe={class:"z-50 text-white w-full m-auto w-[80%]"},he={class:"font-bold text-5xl text-white z-50"},_e={class:"flex py-8"},ye={class:"text-2xl font-semibold"},ge=P(()=>t("path",{d:"M0.999878 6.49976L16.9999 6.49976",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),be=P(()=>t("path",{d:"M5.99972 11.5C5.99972 11.5 0.999767 7.81756 0.999756 6.49996C0.999744 5.18237 5.99976 1.5 5.99976 1.5",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)),$e=[ge,be],we={class:"text-2xl font-semibold"},xe={class:"bg-white auctions px-[2%] py-[3%] pt-[5%]"},ke={class:"text-3xl font-bold max-w-[1280px] p-4 m-auto"},Ae={key:0,class:"text-center py-4"},Ie=["onSubmit"],Ve={class:"col-span-4"},Ee={class:"py-1 relative"},Oe={class:"flex"},Pe={class:"py-2 font-bold text-[#303843]",for:"name",id:"name-label"},Ce={key:0,class:"my-auto text-[#AA1E22] px-1"},Te={class:"py-1 relative"},Se={class:"flex"},qe={class:"py-2 font-bold text-[#303843]",for:"phone",id:"phone-label"},De={key:0,class:"my-auto text-[#AA1E22] px-1"},Fe={key:0,class:"text-[#AA1E22] text-sm"},Me={class:"py-1 relative"},Ue={class:"flex"},Be={class:"py-2 font-bold text-[#303843]",for:"email",id:"email-label"},je={key:0,class:"my-auto text-[#AA1E22] px-1"},ze={key:0,class:"text-[#AA1E22] text-sm"},Le={class:"hidden"},Re={class:"col-span-2 mx-auto"},Ke={class:"rounded-full",style:{border:"5px solid #AA1F23"}},Ne={key:1,class:"m-auto rounded-full bg-gray-200",style:{width:"200px",height:"200px"}},Ye={class:"mx-auto text-center w-full"},Qe={class:"mx-auto text-center w-full"},Je={class:"underline text-[#DDAE05] font-bold text-xl"},We={id:"otp-label",class:"sr-only"},Ge={class:"py-2 relative",role:"group","aria-labelledby":"otp-label"},He={key:0,class:"text-center text-[#AA1E22] font-bold mb-4"},Xe={style:{direction:"ltr"},class:"flex justify-center my-4 gap-2 flex-wrap"},Ze={setup(I){const m=X(),l=d({name:"",phone:"",email:"",profile:"",lang:localStorage.getItem("appLang")||"ar",user_id:localStorage.getItem("user_id")}),w=d({}),M=d(null),V=d(!1),c=d(["","","","","",""]),f=d(""),y=d(!1),x=d(!1),h=d(""),g=d([]),E=d({email:null,sms:null}),k=d({email:null,sms:null}),U=O(()=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return!l.value.email||e.test(l.value.email)}),B=O(()=>{const e=/^\+?\d{10,15}$/;return!l.value.phone||e.test(l.value.phone)}),C=O(()=>l.value.name.trim()&&B.value&&U.value),T=O(()=>c.value.every(e=>e.match(/^[0-9]$/))),R=async()=>{y.value=!0;try{const e=await D.post("api/get_user_profile",{lang:l.value.lang,user_id:parseInt(l.value.user_id)});l.value={...e.data.result.data,lang:l.value.lang,user_id:l.value.user_id},w.value={...e.data.result.data}}catch(e){S(e,$t("فشل في جلب بيانات الملف الشخصي"))}finally{y.value=!1}},K=e=>{const a=e.target.files[0];if(a){if(!a.type.startsWith("image/")){m.add({severity:"error",summary:$t("خطأ"),detail:$t("يرجى تحميل صورة فقط"),life:3e3});return}if(a.size>5*1024*1024){m.add({severity:"error",summary:$t("خطأ"),detail:$t("حجم الصورة كبير جدًا"),life:3e3});return}const s=new FileReader;s.readAsDataURL(a),s.onload=u=>{l.value.profile=u.target.result,l.value.file=a}}},N=()=>{M.value.click()},Y=async()=>{if(!C.value){m.add({severity:"error",summary:$t("خطأ"),detail:$t("يرجى ملء جميع الحقول المطلوبة بشكل صحيح"),life:3e3});return}y.value=!0;try{const e=new FormData;e.append("name",l.value.name),e.append("phone",l.value.phone),e.append("email",l.value.email),e.append("lang",l.value.lang),e.append("user_id",l.value.user_id),l.value.file&&e.append("profile",l.value.file);const a=await D.post("api/update_user_profile",e,{headers:{"Content-Type":"multipart/form-data"}});if(a.data.result.code===200){g.value=[],E.value={email:null,sms:null},k.value={email:null,sms:null};const s=l.value.email!==w.value.email,u=l.value.phone!==w.value.phone;s&&(g.value.push("email"),E.value.email=a.data.result.data.request_id,k.value.email=a.data.result.data.email_code_validity_period),u&&(g.value.push("sms"),E.value.sms=a.data.result.data.sms_otp_validity_period?a.data.result.data.request_id:a.data.result.data.sms_request_id,k.value.sms=a.data.result.data.sms_otp_validity_period),g.value.length>0?(h.value=g.value[0],V.value=!0,m.add({severity:"info",summary:$t("تم إرسال OTP"),detail:$t("تم إرسال رمز التحقق إلى ")+(h.value==="email"?l.value.email:l.value.phone)+$t("، صالح لمدة ")+k.value[h.value]+$t(" دقيقة"),life:5e3})):(m.add({severity:"success",summary:$t("نجاح"),detail:$t("تم تحديث الملف الشخصي بنجاح"),life:3e3}),w.value={...l.value,file:null})}else m.add({severity:"error",summary:$t("خطأ"),detail:a.data.result.message||$t("فشل في تحديث الملف الشخصي"),life:3e3})}catch(e){S(e,$t("فشل في تحديث الملف الشخصي"))}finally{y.value=!1}},Q=(e,a)=>{const s=a.target.value;if(s.match(/^[0-9]$/)){if(c.value[e]=s,f.value="",e<c.value.length-1){const u=document.querySelectorAll(".otp-input")[e+1];u&&u.focus()}}else c.value[e]="",f.value=$t("الرجاء إدخال أرقام فقط")},J=e=>{const a=(e.clipboardData||window.clipboardData).getData("text");if(a.match(/^\d{6}$/)){c.value=a.split(""),f.value="";const s=document.querySelectorAll(".otp-input")[5];s&&s.focus()}else f.value=$t("رمز OTP غير صالح");e.preventDefault()},W=(e,a)=>{if(!c.value[e]&&e>0){const s=document.querySelectorAll(".otp-input")[e-1];s&&s.focus()}},G=async()=>{if(!T.value){f.value=$t("يرجى إدخال رمز OTP كامل");return}x.value=!0;try{const e=await D.post("api/user_profile_verfication",{lang:l.value.lang,user_id:parseInt(l.value.user_id),verfy_with:h.value,request_id:E.value[h.value],verfication_code:c.value.join("")});e.data.result.code===200?(m.add({severity:"success",summary:$t("نجاح"),detail:$t("تم التحقق بنجاح"),life:3e3}),g.value.shift(),c.value=["","","","","",""],f.value="",g.value.length>0?(h.value=g.value[0],m.add({severity:"info",summary:$t("تم إرسال OTP"),detail:$t("تم إرسال رمز التحقق إلى ")+(h.value==="email"?l.value.email:l.value.phone)+$t("، صالح لمدة ")+k.value[h.value]+$t(" دقيقة"),life:5e3})):(V.value=!1,w.value={...l.value,file:null})):f.value=e.data.result.message||$t("فشل في التحقق من رمز OTP")}catch(e){S(e,$t("فشل في التحقق من رمز OTP"))}finally{x.value=!1}},S=(e,a)=>{var u,p,b,_,j;const s=((p=(u=e.response)==null?void 0:u.data)==null?void 0:p.error)||((j=(_=(b=e.response)==null?void 0:b.data)==null?void 0:_.result)==null?void 0:j.message)||a;m.add({severity:"error",summary:$t("خطأ"),detail:s,life:3e3})};return Z(()=>{R()}),(e,a)=>{var u;const s=ee("Toast");return i(),r(L,null,[v(de),t("div",{class:"banner flex items-center h-[35vh] lg:h-[55vh] relative",dir:l.value.lang==="ar"?"rtl":"ltr"},[ve,me,t("div",fe,[t("h1",he,n(e.$t("الصفحه الشخصيه")),1),t("div",_e,[t("p",ye,n(e.$t("home")),1),(i(),r("svg",{class:q(["my-auto mx-[1%]",{"ltr:rotate-180":l.value.lang==="ar"}]),width:"18",height:"13",viewBox:"0 0 18 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},$e,2)),t("p",we,n(e.$t("الصفحه الشخصيه")),1)])])],8,pe),t("div",xe,[t("p",ke,n(e.$t("المعلومات الشخصيه")),1),y.value?(i(),r("div",Ae,n(e.$t("جاري التحميل...")),1)):(i(),r("form",{key:1,onSubmit:le(Y,["prevent"]),class:"max-w-[1280px] shadow-md grid grid-cols-1 p-4 sm:grid-cols-2 lg:grid-cols-6 gap-4 m-auto"},[t("div",Ve,[t("div",Ee,[t("div",Oe,[t("label",Pe,n(e.$t("full_name")),1),l.value.name?$("",!0):(i(),r("span",Ce,"*"))]),v(o(A),{id:"name",required:"","aria-labelledby":"name-label",class:"bg-[#f7f5f5] w-full",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=p=>l.value.name=p),placeholder:e.$t("full_name")},null,8,["modelValue","placeholder"])]),t("div",Te,[t("div",Se,[t("label",qe,n(e.$t("Mobile_number")),1),l.value.phone?$("",!0):(i(),r("span",De,"*"))]),v(o(A),{id:"phone",required:"","aria-labelledby":"phone-label",class:"bg-[#f7f5f5] w-full",modelValue:l.value.phone,"onUpdate:modelValue":a[1]||(a[1]=p=>l.value.phone=p),placeholder:e.$t("Mobile_number")},null,8,["modelValue","placeholder"]),!o(B)&&l.value.phone?(i(),r("div",Fe,n(e.$t("الرجاء إدخال رقم هاتف صحيح")),1)):$("",!0)]),t("div",Me,[t("div",Ue,[t("label",Be,n(e.$t("Your_email_address")),1),l.value.email?$("",!0):(i(),r("span",je,"*"))]),v(o(A),{id:"email",type:"email",required:"","aria-labelledby":"email-label",class:"bg-[#f7f5f5] w-full",modelValue:l.value.email,"onUpdate:modelValue":a[2]||(a[2]=p=>l.value.email=p),placeholder:e.$t("Your_email_address")},null,8,["modelValue","placeholder"]),!o(U)&&l.value.email?(i(),r("div",ze,n(e.$t("الرجاء إدخال بريد إلكتروني صحيح")),1)):$("",!0)]),t("div",Le,[v(o(A),{name:"file",ref_key:"fileInput",ref:M,onChange:K,accept:"image/*",id:"file",type:"file","aria-labelledby":"file-label"},null,512)]),v(o(F),{type:"submit",disabled:y.value||!o(C),class:q([{"opacity-50 cursor-not-allowed":y.value||!o(C)},"mt-3 w-[90%] mx-auto lg:mb-0 bg-primary text-white font-bold py-3 rounded-lg hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-[#AA1E22] transition-colors duration-200"]),label:y.value?e.$t("جاري التحميل..."):e.$t("تعديل")},null,8,["disabled","class","label"])]),t("div",Re,[t("div",Ke,[(u=l.value)!=null&&u.profile?(i(),r("div",{key:0,class:"m-auto rounded-full bg-no-repeat bg-cover",style:ae([{width:"200px",height:"200px"},{backgroundImage:`url(${l.value.profile})`}])},null,4)):(i(),r("div",Ne))]),t("div",Ye,[v(o(F),{onClick:N,class:"mt-3 w-[90%] mx-auto lg:mb-0 bg-primary text-white font-bold py-3 rounded-lg hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-[#AA1E22] transition-colors duration-200",label:e.$t("تعديل")},null,8,["label"])]),t("div",Qe,[t("p",Je,n(e.$t("اكمل حسابك")),1)])])],40,Ie)),v(o(ie),{visible:V.value,"onUpdate:visible":a[4]||(a[4]=p=>V.value=p),modal:!0,header:e.$t("ادخل رمز ال OTP")+` (${h.value==="email"?e.$t("Your_email_address"):e.$t("Mobile_number")})`,class:"w-[90%] max-w-[500px]",dir:l.value.lang==="ar"?"rtl":"ltr"},{footer:z(()=>[v(o(F),{label:x.value?e.$t("جاري التحميل..."):e.$t("تأكيد"),disabled:!o(T)||x.value,class:q([{"opacity-50 cursor-not-allowed":!o(T)||x.value},"bg-primary text-white font-bold py-2 rounded-lg hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-[#AA1E22] transition-colors duration-200"]),onClick:G},null,8,["label","disabled","class"])]),default:z(()=>[t("p",We,n(e.$t("ادخل رمز ال OTP")),1),t("div",Ge,[f.value?(i(),r("p",He,n(f.value),1)):$("",!0),t("div",Xe,[(i(!0),r(L,null,te(c.value,(p,b)=>(i(),se(o(A),{key:b,ref_for:!0,ref:"otpInputs",modelValue:c.value[b],"onUpdate:modelValue":_=>c.value[b]=_,type:"text",inputmode:"numeric",pattern:"[0-9]*",maxlength:"1",placeholder:"-",class:"otp-input w-12 h-14 text-center text-lg font-bold border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#AA1E22] focus:bg-red-50 active:bg-red-50 transition-colors duration-200",onInput:_=>Q(b,_),onPaste:a[3]||(a[3]=_=>J(_)),onKeydown:oe(_=>W(b),["backspace"])},null,8,["modelValue","onUpdate:modelValue","onInput","onKeydown"]))),128))])])]),_:1},8,["visible","header","dir"])]),v(s),v(ce)],64)}}},ol=H(Ze,[["__scopeId","data-v-80ba8110"]]);export{ol as default};
